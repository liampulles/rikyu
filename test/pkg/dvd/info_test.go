package dvd_test

import (
	"fmt"
	"io/ioutil"
	"path"
	"reflect"
	"testing"

	"github.com/liampulles/rikyu/pkg/dvd"
	"github.com/liampulles/rikyu/pkg/exec"
	"github.com/liampulles/rikyu/pkg/types"
)

func TestReadDVDInfoForDirectory_WhenDockerServiceReturnsError_ShouldReturnError(t *testing.T) {
	// Setup fixture
	expectedErr := fmt.Errorf("some error")
	mds := &mockDockerService{err: expectedErr}
	DVDServiceImpl := dvd.NewDVDServiceImpl(mds)

	// Exercise SUT
	actual, err := DVDServiceImpl.ReadDVDInfoForDirectory("some dir")

	// Verify results
	if actual != nil {
		t.Errorf("Expected response to be nil, but was %v", actual)
	}
	if err == nil {
		t.Errorf("Expected an err, but was nil")
	} else if !reflect.DeepEqual(err, expectedErr) {
		t.Errorf("Expected error did not match actual\nExpected: %v\nActual: %v", expectedErr, err)
	}
}

func TestReadDVDInfoForDirectory_WhenLsdvdReturnsUnexpectedStr_ShouldReturnError(t *testing.T) {
	// Setup fixture
	mds := &mockDockerService{stdOut: "clearly not xml"}
	DVDServiceImpl := dvd.NewDVDServiceImpl(mds)

	// Exercise SUT
	actual, err := DVDServiceImpl.ReadDVDInfoForDirectory("some dir")

	// Verify results
	if actual != nil {
		t.Errorf("Expected response to be nil, but was %v", actual)
	}
	if err == nil {
		t.Errorf("Expected an err, but was nil")
	}
}

func TestReadDVDInfoForDirectory_WhenLsdvdReturnsValidXML_ShouldTransformIntoValidResult(t *testing.T) {
	// Setup fixture
	content, _ := ioutil.ReadFile(path.Join("testdata", "example.lsdvd.output"))
	mds := &mockDockerService{stdOut: string(content)}
	DVDServiceImpl := dvd.NewDVDServiceImpl(mds)
	// Setup expected
	expected := &types.DVD{DiscTitle: "XFILES_S1_DISC1", TitleSets: []types.TitleSet{types.TitleSet{Titles: []types.Title{types.Title{TitleNumber: 1, Angles: 1, FPS: 25, Width: 720, Height: 576, Format: "PAL", AutomaticLetterbox: false, Length: 2777399999987, AudioTracks: []types.Audio{types.Audio{Language: types.Language{Code: "cs", Name: "Czech"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}, types.Audio{Language: types.Language{Code: "en", Name: "English"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}, types.Audio{Language: types.Language{Code: "pl", Name: "Polish"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}}, SubtitleTracks: []types.Subtitle{types.Subtitle{Language: types.Language{Code: "bg", Name: "Bulgarian"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "hr", Name: "Hrvatski"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "cs", Name: "Czech"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "da", Name: "Dansk"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "en", Name: "English"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "fi", Name: "Suomi"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "no", Name: "Norsk"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "pl", Name: "Polish"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "pt", Name: "Portugues"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "sl", Name: "Slovenian"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "sv", Name: "Svenska"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "cs", Name: "Czech"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "pl", Name: "Polish"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "en", Name: "English"}, Content: "Undefined"}}, Chapters: []types.Chapter{types.Chapter{Length: 131759999999, StartCell: 1}, types.Chapter{Length: 536200000000, StartCell: 2}, types.Chapter{Length: 180479999999, StartCell: 6}, types.Chapter{Length: 135120000000, StartCell: 7}, types.Chapter{Length: 185199999999, StartCell: 8}, types.Chapter{Length: 178199999999, StartCell: 9}, types.Chapter{Length: 413680000000, StartCell: 10}, types.Chapter{Length: 228439999999, StartCell: 11}, types.Chapter{Length: 240680000000, StartCell: 12}, types.Chapter{Length: 286399999999, StartCell: 13}, types.Chapter{Length: 231560000000, StartCell: 14}, types.Chapter{Length: 29199999999, StartCell: 18}, types.Chapter{Length: 480000000, StartCell: 19}}, Cells: []types.Cell{types.Cell{Length: 131759999999}, types.Cell{Length: 346720000000}, types.Cell{Length: 1199999999}, types.Cell{Length: 9599999999}, types.Cell{Length: 178680000000}, types.Cell{Length: 180479999999}, types.Cell{Length: 135120000000}, types.Cell{Length: 185199999999}, types.Cell{Length: 178199999999}, types.Cell{Length: 413680000000}, types.Cell{Length: 228439999999}, types.Cell{Length: 240680000000}, types.Cell{Length: 286399999999}, types.Cell{Length: 116319999999}, types.Cell{Length: 1199999999}, types.Cell{Length: 9599999999}, types.Cell{Length: 104439999999}, types.Cell{Length: 29199999999}, types.Cell{Length: 480000000}}, Palette: types.Palette{"108080", "eb8080", "808080", "808080", "808080", "808080", "808080", "eb8080", "808080", "b08080", "808080", "808080", "808080", "808080", "808080", "808080"}}, types.Title{TitleNumber: 2, Angles: 1, FPS: 25, Width: 720, Height: 576, Format: "PAL", AutomaticLetterbox: false, Length: 2637559999994, AudioTracks: []types.Audio{types.Audio{Language: types.Language{Code: "cs", Name: "Czech"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}, types.Audio{Language: types.Language{Code: "en", Name: "English"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}, types.Audio{Language: types.Language{Code: "pl", Name: "Polish"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}}, SubtitleTracks: []types.Subtitle{types.Subtitle{Language: types.Language{Code: "bg", Name: "Bulgarian"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "hr", Name: "Hrvatski"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "cs", Name: "Czech"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "da", Name: "Dansk"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "en", Name: "English"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "fi", Name: "Suomi"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "no", Name: "Norsk"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "pl", Name: "Polish"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "pt", Name: "Portugues"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "sl", Name: "Slovenian"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "sv", Name: "Svenska"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "cs", Name: "Czech"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "pl", Name: "Polish"}, Content: "Undefined"}}, Chapters: []types.Chapter{types.Chapter{Length: 78680000000, StartCell: 1}, types.Chapter{Length: 44079999999, StartCell: 2}, types.Chapter{Length: 314319999999, StartCell: 3}, types.Chapter{Length: 269120000000, StartCell: 4}, types.Chapter{Length: 605960000000, StartCell: 5}, types.Chapter{Length: 219719999999, StartCell: 6}, types.Chapter{Length: 282639999999, StartCell: 7}, types.Chapter{Length: 214199999999, StartCell: 8}, types.Chapter{Length: 164960000000, StartCell: 9}, types.Chapter{Length: 294000000000, StartCell: 10}, types.Chapter{Length: 115040000000, StartCell: 11}, types.Chapter{Length: 34359999999, StartCell: 12}, types.Chapter{Length: 480000000, StartCell: 13}}, Cells: []types.Cell{types.Cell{Length: 78680000000}, types.Cell{Length: 44079999999}, types.Cell{Length: 314319999999}, types.Cell{Length: 269120000000}, types.Cell{Length: 605960000000}, types.Cell{Length: 219719999999}, types.Cell{Length: 282639999999}, types.Cell{Length: 214199999999}, types.Cell{Length: 164960000000}, types.Cell{Length: 294000000000}, types.Cell{Length: 115040000000}, types.Cell{Length: 34359999999}, types.Cell{Length: 480000000}}, Palette: types.Palette{"108080", "808080", "808080", "808080", "808080", "808080", "808080", "eb8080", "808080", "b08080", "808080", "808080", "808080", "808080", "808080", "808080"}}, types.Title{TitleNumber: 3, Angles: 1, FPS: 25, Width: 720, Height: 576, Format: "PAL", AutomaticLetterbox: false, Length: 2465879999993, AudioTracks: []types.Audio{types.Audio{Language: types.Language{Code: "cs", Name: "Czech"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}, types.Audio{Language: types.Language{Code: "en", Name: "English"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}, types.Audio{Language: types.Language{Code: "pl", Name: "Polish"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}}, SubtitleTracks: []types.Subtitle{types.Subtitle{Language: types.Language{Code: "bg", Name: "Bulgarian"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "hr", Name: "Hrvatski"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "cs", Name: "Czech"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "da", Name: "Dansk"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "en", Name: "English"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "fi", Name: "Suomi"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "no", Name: "Norsk"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "pl", Name: "Polish"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "pt", Name: "Portugues"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "sl", Name: "Slovenian"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "sv", Name: "Svenska"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "cs", Name: "Czech"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "pl", Name: "Polish"}, Content: "Undefined"}}, Chapters: []types.Chapter{types.Chapter{Length: 195479999999, StartCell: 1}, types.Chapter{Length: 44000000000, StartCell: 2}, types.Chapter{Length: 465360000000, StartCell: 3}, types.Chapter{Length: 165520000000, StartCell: 4}, types.Chapter{Length: 300079999999, StartCell: 5}, types.Chapter{Length: 244560000000, StartCell: 6}, types.Chapter{Length: 317680000000, StartCell: 7}, types.Chapter{Length: 248319999999, StartCell: 8}, types.Chapter{Length: 163479999999, StartCell: 9}, types.Chapter{Length: 150639999999, StartCell: 10}, types.Chapter{Length: 132879999999, StartCell: 11}, types.Chapter{Length: 37399999999, StartCell: 12}, types.Chapter{Length: 480000000, StartCell: 13}}, Cells: []types.Cell{types.Cell{Length: 195479999999}, types.Cell{Length: 44000000000}, types.Cell{Length: 465360000000}, types.Cell{Length: 165520000000}, types.Cell{Length: 300079999999}, types.Cell{Length: 244560000000}, types.Cell{Length: 317680000000}, types.Cell{Length: 248319999999}, types.Cell{Length: 163479999999}, types.Cell{Length: 150639999999}, types.Cell{Length: 132879999999}, types.Cell{Length: 37399999999}, types.Cell{Length: 480000000}}, Palette: types.Palette{"108080", "808080", "808080", "808080", "808080", "808080", "808080", "eb8080", "808080", "b08080", "808080", "808080", "808080", "808080", "808080", "808080"}}, types.Title{TitleNumber: 4, Angles: 1, FPS: 25, Width: 720, Height: 576, Format: "PAL", AutomaticLetterbox: false, Length: 2547999999993, AudioTracks: []types.Audio{types.Audio{Language: types.Language{Code: "cs", Name: "Czech"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}, types.Audio{Language: types.Language{Code: "en", Name: "English"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}, types.Audio{Language: types.Language{Code: "pl", Name: "Polish"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}}, SubtitleTracks: []types.Subtitle{types.Subtitle{Language: types.Language{Code: "bg", Name: "Bulgarian"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "hr", Name: "Hrvatski"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "cs", Name: "Czech"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "da", Name: "Dansk"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "en", Name: "English"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "fi", Name: "Suomi"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "no", Name: "Norsk"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "pl", Name: "Polish"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "pt", Name: "Portugues"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "sl", Name: "Slovenian"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "sv", Name: "Svenska"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "cs", Name: "Czech"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "pl", Name: "Polish"}, Content: "Undefined"}}, Chapters: []types.Chapter{types.Chapter{Length: 168479999999, StartCell: 1}, types.Chapter{Length: 233879999999, StartCell: 2}, types.Chapter{Length: 196639999999, StartCell: 3}, types.Chapter{Length: 383120000000, StartCell: 4}, types.Chapter{Length: 474720000000, StartCell: 5}, types.Chapter{Length: 247919999999, StartCell: 6}, types.Chapter{Length: 228840000000, StartCell: 7}, types.Chapter{Length: 102920000000, StartCell: 8}, types.Chapter{Length: 394879999999, StartCell: 9}, types.Chapter{Length: 81439999999, StartCell: 10}, types.Chapter{Length: 34679999999, StartCell: 11}, types.Chapter{Length: 480000000, StartCell: 12}}, Cells: []types.Cell{types.Cell{Length: 168479999999}, types.Cell{Length: 233879999999}, types.Cell{Length: 196639999999}, types.Cell{Length: 383120000000}, types.Cell{Length: 474720000000}, types.Cell{Length: 247919999999}, types.Cell{Length: 228840000000}, types.Cell{Length: 102920000000}, types.Cell{Length: 394879999999}, types.Cell{Length: 81439999999}, types.Cell{Length: 34679999999}, types.Cell{Length: 480000000}}, Palette: types.Palette{"108080", "808080", "808080", "808080", "808080", "808080", "808080", "eb8080", "808080", "b08080", "808080", "808080", "808080", "808080", "808080", "808080"}}, types.Title{TitleNumber: 5, Angles: 1, FPS: 25, Width: 720, Height: 576, Format: "PAL", AutomaticLetterbox: false, Length: 63519999999, AudioTracks: []types.Audio{types.Audio{Language: types.Language{Code: "ja", Name: "Japanese"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}}, SubtitleTracks: []types.Subtitle{types.Subtitle{Language: types.Language{Code: "bg", Name: "Bulgarian"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "hr", Name: "Hrvatski"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "cs", Name: "Czech"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "da", Name: "Dansk"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "en", Name: "English"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "fi", Name: "Suomi"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "no", Name: "Norsk"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "pl", Name: "Polish"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "pt", Name: "Portugues"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "sl", Name: "Slovenian"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "sv", Name: "Svenska"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "cs", Name: "Czech"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "pl", Name: "Polish"}, Content: "Undefined"}}, Chapters: []types.Chapter{types.Chapter{Length: 63039999999, StartCell: 1}, types.Chapter{Length: 480000000, StartCell: 2}}, Cells: []types.Cell{types.Cell{Length: 63039999999}, types.Cell{Length: 480000000}}, Palette: types.Palette{"808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080"}}, types.Title{TitleNumber: 6, Angles: 1, FPS: 25, Width: 720, Height: 576, Format: "PAL", AutomaticLetterbox: false, Length: 72680000000, AudioTracks: []types.Audio{types.Audio{Language: types.Language{Code: "de", Name: "Deutsch"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}}, SubtitleTracks: []types.Subtitle{types.Subtitle{Language: types.Language{Code: "bg", Name: "Bulgarian"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "hr", Name: "Hrvatski"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "cs", Name: "Czech"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "da", Name: "Dansk"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "en", Name: "English"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "fi", Name: "Suomi"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "no", Name: "Norsk"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "pl", Name: "Polish"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "pt", Name: "Portugues"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "sl", Name: "Slovenian"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "sv", Name: "Svenska"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "cs", Name: "Czech"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "pl", Name: "Polish"}, Content: "Undefined"}}, Chapters: []types.Chapter{types.Chapter{Length: 72200000000, StartCell: 1}, types.Chapter{Length: 480000000, StartCell: 2}}, Cells: []types.Cell{types.Cell{Length: 72200000000}, types.Cell{Length: 480000000}}, Palette: types.Palette{"808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080"}}, types.Title{TitleNumber: 7, Angles: 1, FPS: 25, Width: 720, Height: 576, Format: "PAL", AutomaticLetterbox: false, Length: 65760000000, AudioTracks: []types.Audio{types.Audio{Language: types.Language{Code: "es", Name: "Espanol"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}}, SubtitleTracks: []types.Subtitle{types.Subtitle{Language: types.Language{Code: "bg", Name: "Bulgarian"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "hr", Name: "Hrvatski"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "cs", Name: "Czech"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "da", Name: "Dansk"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "en", Name: "English"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "fi", Name: "Suomi"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "no", Name: "Norsk"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "pl", Name: "Polish"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "pt", Name: "Portugues"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "sl", Name: "Slovenian"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "sv", Name: "Svenska"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "cs", Name: "Czech"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "pl", Name: "Polish"}, Content: "Undefined"}}, Chapters: []types.Chapter{types.Chapter{Length: 65280000000, StartCell: 1}, types.Chapter{Length: 480000000, StartCell: 2}}, Cells: []types.Cell{types.Cell{Length: 65280000000}, types.Cell{Length: 480000000}}, Palette: types.Palette{"808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080"}}, types.Title{TitleNumber: 8, Angles: 1, FPS: 25, Width: 720, Height: 576, Format: "PAL", AutomaticLetterbox: false, Length: 54879999999, AudioTracks: []types.Audio{types.Audio{Language: types.Language{Code: "it", Name: "Italiano"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}}, SubtitleTracks: []types.Subtitle{types.Subtitle{Language: types.Language{Code: "bg", Name: "Bulgarian"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "hr", Name: "Hrvatski"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "cs", Name: "Czech"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "da", Name: "Dansk"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "en", Name: "English"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "fi", Name: "Suomi"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "no", Name: "Norsk"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "pl", Name: "Polish"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "pt", Name: "Portugues"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "sl", Name: "Slovenian"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "sv", Name: "Svenska"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "cs", Name: "Czech"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "pl", Name: "Polish"}, Content: "Undefined"}}, Chapters: []types.Chapter{types.Chapter{Length: 54399999999, StartCell: 1}, types.Chapter{Length: 480000000, StartCell: 2}}, Cells: []types.Cell{types.Cell{Length: 54399999999}, types.Cell{Length: 480000000}}, Palette: types.Palette{"808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080"}}, types.Title{TitleNumber: 9, Angles: 1, FPS: 25, Width: 720, Height: 576, Format: "PAL", AutomaticLetterbox: false, Length: 480000000, AudioTracks: []types.Audio(nil), SubtitleTracks: []types.Subtitle(nil), Chapters: []types.Chapter{types.Chapter{Length: 480000000, StartCell: 1}}, Cells: []types.Cell{types.Cell{Length: 480000000}}, Palette: types.Palette{"808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080"}}, types.Title{TitleNumber: 10, Angles: 1, FPS: 25, Width: 720, Height: 576, Format: "PAL", AutomaticLetterbox: false, Length: 99760000000, AudioTracks: []types.Audio{types.Audio{Language: types.Language{Code: "cs", Name: "Czech"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}, types.Audio{Language: types.Language{Code: "en", Name: "English"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}, types.Audio{Language: types.Language{Code: "pl", Name: "Polish"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}}, SubtitleTracks: []types.Subtitle{types.Subtitle{Language: types.Language{Code: "bg", Name: "Bulgarian"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "hr", Name: "Hrvatski"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "cs", Name: "Czech"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "da", Name: "Dansk"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "en", Name: "English"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "fi", Name: "Suomi"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "no", Name: "Norsk"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "pl", Name: "Polish"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "pt", Name: "Portugues"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "sl", Name: "Slovenian"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "sv", Name: "Svenska"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "cs", Name: "Czech"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "pl", Name: "Polish"}, Content: "Undefined"}}, Chapters: []types.Chapter{types.Chapter{Length: 99760000000, StartCell: 1}}, Cells: []types.Cell{types.Cell{Length: 99760000000}}, Palette: types.Palette{"808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080"}}, types.Title{TitleNumber: 11, Angles: 1, FPS: 25, Width: 720, Height: 576, Format: "PAL", AutomaticLetterbox: false, Length: 79079999999, AudioTracks: []types.Audio{types.Audio{Language: types.Language{Code: "cs", Name: "Czech"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}, types.Audio{Language: types.Language{Code: "en", Name: "English"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}, types.Audio{Language: types.Language{Code: "pl", Name: "Polish"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}}, SubtitleTracks: []types.Subtitle{types.Subtitle{Language: types.Language{Code: "bg", Name: "Bulgarian"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "hr", Name: "Hrvatski"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "cs", Name: "Czech"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "da", Name: "Dansk"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "en", Name: "English"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "fi", Name: "Suomi"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "no", Name: "Norsk"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "pl", Name: "Polish"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "pt", Name: "Portugues"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "sl", Name: "Slovenian"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "sv", Name: "Svenska"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "cs", Name: "Czech"}, Content: "Undefined"}, types.Subtitle{Language: types.Language{Code: "pl", Name: "Polish"}, Content: "Undefined"}}, Chapters: []types.Chapter{types.Chapter{Length: 79079999999, StartCell: 1}}, Cells: []types.Cell{types.Cell{Length: 79079999999}}, Palette: types.Palette{"808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080"}}}}, types.TitleSet{Titles: []types.Title{types.Title{TitleNumber: 12, Angles: 1, FPS: 25, Width: 720, Height: 576, Format: "PAL", AutomaticLetterbox: true, Length: 27319999999, AudioTracks: []types.Audio{types.Audio{Language: types.Language{Code: "cs", Name: "Czech"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 6}}, SubtitleTracks: []types.Subtitle(nil), Chapters: []types.Chapter{types.Chapter{Length: 26839999999, StartCell: 1}, types.Chapter{Length: 480000000, StartCell: 2}}, Cells: []types.Cell{types.Cell{Length: 26839999999}, types.Cell{Length: 480000000}}, Palette: types.Palette{"808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080"}}}}, types.TitleSet{Titles: []types.Title{types.Title{TitleNumber: 13, Angles: 1, FPS: 25, Width: 720, Height: 576, Format: "PAL", AutomaticLetterbox: true, Length: 48720000000, AudioTracks: []types.Audio{types.Audio{Language: types.Language{Code: "cs", Name: "Czech"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}}, SubtitleTracks: []types.Subtitle(nil), Chapters: []types.Chapter{types.Chapter{Length: 48240000000, StartCell: 1}, types.Chapter{Length: 480000000, StartCell: 2}}, Cells: []types.Cell{types.Cell{Length: 48240000000}, types.Cell{Length: 480000000}}, Palette: types.Palette{"808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080"}}, types.Title{TitleNumber: 14, Angles: 1, FPS: 25, Width: 720, Height: 576, Format: "PAL", AutomaticLetterbox: true, Length: 49839999999, AudioTracks: []types.Audio{types.Audio{Language: types.Language{Code: "cs", Name: "Czech"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}}, SubtitleTracks: []types.Subtitle(nil), Chapters: []types.Chapter{types.Chapter{Length: 49359999999, StartCell: 1}, types.Chapter{Length: 480000000, StartCell: 2}}, Cells: []types.Cell{types.Cell{Length: 49359999999}, types.Cell{Length: 480000000}}, Palette: types.Palette{"808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080"}}}}}}

	// Exercise SUT
	actual, err := DVDServiceImpl.ReadDVDInfoForDirectory("some dir")

	// Verify results
	if err != nil {
		t.Errorf("Expected nil error, but got %v", err)
	}
	if !reflect.DeepEqual(actual, expected) {
		t.Errorf("Response did not match expected\nExpected: %#v\nActual: %#v", expected, actual)
	}
}

// func TestRealDVD(t *testing.T) {
// 	ds := exec.NewDockerServiceImpl(func() (exec.DockerClientWrapper, error) {
// 		return client.NewEnvClient()
// 	})
// 	DVDServiceImpl := types.NewDVDServiceImpl(ds)

// 	dvd, err := DVDServiceImpl.ReadDVDInfoForDirectory("/media/liam/XFILES_S1_DISC1/")

// 	fmt.Println(dvd)
// 	fmt.Println(err)
// }

type mockDockerService struct {
	stdOut string
	stdErr string
	err    error
}

func (mds *mockDockerService) RunDockerContainerForOutput(image string, mounts []exec.DockerVolumeMount, args []string) (string, string, error) {
	return mds.stdOut, mds.stdErr, mds.err
}
