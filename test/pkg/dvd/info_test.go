package dvd_test

import (
	"fmt"
	"io/ioutil"
	"path"
	"reflect"
	"testing"

	"github.com/liampulles/rikyu/pkg/dvd"
	"github.com/liampulles/rikyu/pkg/exec"
)

func TestReadDVDInfoForDirectory_WhenDockerServiceReturnsError_ShouldReturnError(t *testing.T) {
	// Setup fixture
	expectedErr := fmt.Errorf("some error")
	mds := &mockDockerService{err: expectedErr}
	dvdInfoServiceImpl := dvd.NewDVDInfoServiceImpl(mds)

	// Exercise SUT
	actual, err := dvdInfoServiceImpl.ReadDVDInfoForDirectory("some dir")

	// Verify results
	if actual != nil {
		t.Errorf("Expected response to be nil, but was %v", actual)
	}
	if err == nil {
		t.Errorf("Expected an err, but was nil")
	} else if !reflect.DeepEqual(err, expectedErr) {
		t.Errorf("Expected error did not match actual\nExpected: %v\nActual: %v", expectedErr, err)
	}
}

func TestReadDVDInfoForDirectory_WhenLsdvdReturnsUnexpectedStr_ShouldReturnError(t *testing.T) {
	// Setup fixture
	mds := &mockDockerService{stdOut: "clearly not xml"}
	dvdInfoServiceImpl := dvd.NewDVDInfoServiceImpl(mds)

	// Exercise SUT
	actual, err := dvdInfoServiceImpl.ReadDVDInfoForDirectory("some dir")

	// Verify results
	if actual != nil {
		t.Errorf("Expected response to be nil, but was %v", actual)
	}
	if err == nil {
		t.Errorf("Expected an err, but was nil")
	}
}

func TestReadDVDInfoForDirectory_WhenLsdvdReturnsValidXML_ShouldTransformIntoValidResult(t *testing.T) {
	// Setup fixture
	content, _ := ioutil.ReadFile(path.Join("testdata", "example.lsdvd.output"))
	mds := &mockDockerService{stdOut: string(content)}
	dvdInfoServiceImpl := dvd.NewDVDInfoServiceImpl(mds)
	expected := &dvd.DVD{DiscTitle: "XFILES_S1_DISC1", TitleSets: []dvd.TitleSet{dvd.TitleSet{Titles: []dvd.Title{dvd.Title{TitleNumber: 1, Angles: 1, FPS: 25, Width: 720, Height: 576, Format: "PAL", AutomaticLetterbox: false, Length: 2777399999987, AudioTracks: []dvd.Audio{dvd.Audio{Language: dvd.Language{Code: "cs", Name: "Czech"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}, dvd.Audio{Language: dvd.Language{Code: "en", Name: "English"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}, dvd.Audio{Language: dvd.Language{Code: "pl", Name: "Polish"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}}, SubtitleTracks: []dvd.Subtitle{dvd.Subtitle{Language: dvd.Language{Code: "bg", Name: "Bulgarian"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "hr", Name: "Hrvatski"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "cs", Name: "Czech"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "da", Name: "Dansk"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "en", Name: "English"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "fi", Name: "Suomi"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "no", Name: "Norsk"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "pl", Name: "Polish"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "pt", Name: "Portugues"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "sl", Name: "Slovenian"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "sv", Name: "Svenska"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "cs", Name: "Czech"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "pl", Name: "Polish"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "en", Name: "English"}, Content: "Undefined"}}, Chapters: []dvd.Chapter{dvd.Chapter{Length: 131759999999, StartCell: 1}, dvd.Chapter{Length: 536200000000, StartCell: 2}, dvd.Chapter{Length: 180479999999, StartCell: 6}, dvd.Chapter{Length: 135120000000, StartCell: 7}, dvd.Chapter{Length: 185199999999, StartCell: 8}, dvd.Chapter{Length: 178199999999, StartCell: 9}, dvd.Chapter{Length: 413680000000, StartCell: 10}, dvd.Chapter{Length: 228439999999, StartCell: 11}, dvd.Chapter{Length: 240680000000, StartCell: 12}, dvd.Chapter{Length: 286399999999, StartCell: 13}, dvd.Chapter{Length: 231560000000, StartCell: 14}, dvd.Chapter{Length: 29199999999, StartCell: 18}, dvd.Chapter{Length: 480000000, StartCell: 19}}, Cells: []dvd.Cell{dvd.Cell{Length: 131759999999}, dvd.Cell{Length: 346720000000}, dvd.Cell{Length: 1199999999}, dvd.Cell{Length: 9599999999}, dvd.Cell{Length: 178680000000}, dvd.Cell{Length: 180479999999}, dvd.Cell{Length: 135120000000}, dvd.Cell{Length: 185199999999}, dvd.Cell{Length: 178199999999}, dvd.Cell{Length: 413680000000}, dvd.Cell{Length: 228439999999}, dvd.Cell{Length: 240680000000}, dvd.Cell{Length: 286399999999}, dvd.Cell{Length: 116319999999}, dvd.Cell{Length: 1199999999}, dvd.Cell{Length: 9599999999}, dvd.Cell{Length: 104439999999}, dvd.Cell{Length: 29199999999}, dvd.Cell{Length: 480000000}}, Palette: dvd.Palette{"108080", "eb8080", "808080", "808080", "808080", "808080", "808080", "eb8080", "808080", "b08080", "808080", "808080", "808080", "808080", "808080", "808080"}}, dvd.Title{TitleNumber: 2, Angles: 1, FPS: 25, Width: 720, Height: 576, Format: "PAL", AutomaticLetterbox: false, Length: 2637559999994, AudioTracks: []dvd.Audio{dvd.Audio{Language: dvd.Language{Code: "cs", Name: "Czech"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}, dvd.Audio{Language: dvd.Language{Code: "en", Name: "English"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}, dvd.Audio{Language: dvd.Language{Code: "pl", Name: "Polish"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}}, SubtitleTracks: []dvd.Subtitle{dvd.Subtitle{Language: dvd.Language{Code: "bg", Name: "Bulgarian"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "hr", Name: "Hrvatski"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "cs", Name: "Czech"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "da", Name: "Dansk"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "en", Name: "English"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "fi", Name: "Suomi"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "no", Name: "Norsk"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "pl", Name: "Polish"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "pt", Name: "Portugues"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "sl", Name: "Slovenian"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "sv", Name: "Svenska"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "cs", Name: "Czech"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "pl", Name: "Polish"}, Content: "Undefined"}}, Chapters: []dvd.Chapter{dvd.Chapter{Length: 78680000000, StartCell: 1}, dvd.Chapter{Length: 44079999999, StartCell: 2}, dvd.Chapter{Length: 314319999999, StartCell: 3}, dvd.Chapter{Length: 269120000000, StartCell: 4}, dvd.Chapter{Length: 605960000000, StartCell: 5}, dvd.Chapter{Length: 219719999999, StartCell: 6}, dvd.Chapter{Length: 282639999999, StartCell: 7}, dvd.Chapter{Length: 214199999999, StartCell: 8}, dvd.Chapter{Length: 164960000000, StartCell: 9}, dvd.Chapter{Length: 294000000000, StartCell: 10}, dvd.Chapter{Length: 115040000000, StartCell: 11}, dvd.Chapter{Length: 34359999999, StartCell: 12}, dvd.Chapter{Length: 480000000, StartCell: 13}}, Cells: []dvd.Cell{dvd.Cell{Length: 78680000000}, dvd.Cell{Length: 44079999999}, dvd.Cell{Length: 314319999999}, dvd.Cell{Length: 269120000000}, dvd.Cell{Length: 605960000000}, dvd.Cell{Length: 219719999999}, dvd.Cell{Length: 282639999999}, dvd.Cell{Length: 214199999999}, dvd.Cell{Length: 164960000000}, dvd.Cell{Length: 294000000000}, dvd.Cell{Length: 115040000000}, dvd.Cell{Length: 34359999999}, dvd.Cell{Length: 480000000}}, Palette: dvd.Palette{"108080", "808080", "808080", "808080", "808080", "808080", "808080", "eb8080", "808080", "b08080", "808080", "808080", "808080", "808080", "808080", "808080"}}, dvd.Title{TitleNumber: 3, Angles: 1, FPS: 25, Width: 720, Height: 576, Format: "PAL", AutomaticLetterbox: false, Length: 2465879999993, AudioTracks: []dvd.Audio{dvd.Audio{Language: dvd.Language{Code: "cs", Name: "Czech"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}, dvd.Audio{Language: dvd.Language{Code: "en", Name: "English"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}, dvd.Audio{Language: dvd.Language{Code: "pl", Name: "Polish"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}}, SubtitleTracks: []dvd.Subtitle{dvd.Subtitle{Language: dvd.Language{Code: "bg", Name: "Bulgarian"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "hr", Name: "Hrvatski"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "cs", Name: "Czech"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "da", Name: "Dansk"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "en", Name: "English"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "fi", Name: "Suomi"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "no", Name: "Norsk"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "pl", Name: "Polish"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "pt", Name: "Portugues"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "sl", Name: "Slovenian"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "sv", Name: "Svenska"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "cs", Name: "Czech"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "pl", Name: "Polish"}, Content: "Undefined"}}, Chapters: []dvd.Chapter{dvd.Chapter{Length: 195479999999, StartCell: 1}, dvd.Chapter{Length: 44000000000, StartCell: 2}, dvd.Chapter{Length: 465360000000, StartCell: 3}, dvd.Chapter{Length: 165520000000, StartCell: 4}, dvd.Chapter{Length: 300079999999, StartCell: 5}, dvd.Chapter{Length: 244560000000, StartCell: 6}, dvd.Chapter{Length: 317680000000, StartCell: 7}, dvd.Chapter{Length: 248319999999, StartCell: 8}, dvd.Chapter{Length: 163479999999, StartCell: 9}, dvd.Chapter{Length: 150639999999, StartCell: 10}, dvd.Chapter{Length: 132879999999, StartCell: 11}, dvd.Chapter{Length: 37399999999, StartCell: 12}, dvd.Chapter{Length: 480000000, StartCell: 13}}, Cells: []dvd.Cell{dvd.Cell{Length: 195479999999}, dvd.Cell{Length: 44000000000}, dvd.Cell{Length: 465360000000}, dvd.Cell{Length: 165520000000}, dvd.Cell{Length: 300079999999}, dvd.Cell{Length: 244560000000}, dvd.Cell{Length: 317680000000}, dvd.Cell{Length: 248319999999}, dvd.Cell{Length: 163479999999}, dvd.Cell{Length: 150639999999}, dvd.Cell{Length: 132879999999}, dvd.Cell{Length: 37399999999}, dvd.Cell{Length: 480000000}}, Palette: dvd.Palette{"108080", "808080", "808080", "808080", "808080", "808080", "808080", "eb8080", "808080", "b08080", "808080", "808080", "808080", "808080", "808080", "808080"}}, dvd.Title{TitleNumber: 4, Angles: 1, FPS: 25, Width: 720, Height: 576, Format: "PAL", AutomaticLetterbox: false, Length: 2547999999993, AudioTracks: []dvd.Audio{dvd.Audio{Language: dvd.Language{Code: "cs", Name: "Czech"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}, dvd.Audio{Language: dvd.Language{Code: "en", Name: "English"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}, dvd.Audio{Language: dvd.Language{Code: "pl", Name: "Polish"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}}, SubtitleTracks: []dvd.Subtitle{dvd.Subtitle{Language: dvd.Language{Code: "bg", Name: "Bulgarian"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "hr", Name: "Hrvatski"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "cs", Name: "Czech"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "da", Name: "Dansk"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "en", Name: "English"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "fi", Name: "Suomi"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "no", Name: "Norsk"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "pl", Name: "Polish"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "pt", Name: "Portugues"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "sl", Name: "Slovenian"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "sv", Name: "Svenska"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "cs", Name: "Czech"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "pl", Name: "Polish"}, Content: "Undefined"}}, Chapters: []dvd.Chapter{dvd.Chapter{Length: 168479999999, StartCell: 1}, dvd.Chapter{Length: 233879999999, StartCell: 2}, dvd.Chapter{Length: 196639999999, StartCell: 3}, dvd.Chapter{Length: 383120000000, StartCell: 4}, dvd.Chapter{Length: 474720000000, StartCell: 5}, dvd.Chapter{Length: 247919999999, StartCell: 6}, dvd.Chapter{Length: 228840000000, StartCell: 7}, dvd.Chapter{Length: 102920000000, StartCell: 8}, dvd.Chapter{Length: 394879999999, StartCell: 9}, dvd.Chapter{Length: 81439999999, StartCell: 10}, dvd.Chapter{Length: 34679999999, StartCell: 11}, dvd.Chapter{Length: 480000000, StartCell: 12}}, Cells: []dvd.Cell{dvd.Cell{Length: 168479999999}, dvd.Cell{Length: 233879999999}, dvd.Cell{Length: 196639999999}, dvd.Cell{Length: 383120000000}, dvd.Cell{Length: 474720000000}, dvd.Cell{Length: 247919999999}, dvd.Cell{Length: 228840000000}, dvd.Cell{Length: 102920000000}, dvd.Cell{Length: 394879999999}, dvd.Cell{Length: 81439999999}, dvd.Cell{Length: 34679999999}, dvd.Cell{Length: 480000000}}, Palette: dvd.Palette{"108080", "808080", "808080", "808080", "808080", "808080", "808080", "eb8080", "808080", "b08080", "808080", "808080", "808080", "808080", "808080", "808080"}}, dvd.Title{TitleNumber: 5, Angles: 1, FPS: 25, Width: 720, Height: 576, Format: "PAL", AutomaticLetterbox: false, Length: 63519999999, AudioTracks: []dvd.Audio{dvd.Audio{Language: dvd.Language{Code: "ja", Name: "Japanese"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}}, SubtitleTracks: []dvd.Subtitle{dvd.Subtitle{Language: dvd.Language{Code: "bg", Name: "Bulgarian"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "hr", Name: "Hrvatski"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "cs", Name: "Czech"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "da", Name: "Dansk"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "en", Name: "English"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "fi", Name: "Suomi"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "no", Name: "Norsk"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "pl", Name: "Polish"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "pt", Name: "Portugues"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "sl", Name: "Slovenian"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "sv", Name: "Svenska"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "cs", Name: "Czech"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "pl", Name: "Polish"}, Content: "Undefined"}}, Chapters: []dvd.Chapter{dvd.Chapter{Length: 63039999999, StartCell: 1}, dvd.Chapter{Length: 480000000, StartCell: 2}}, Cells: []dvd.Cell{dvd.Cell{Length: 63039999999}, dvd.Cell{Length: 480000000}}, Palette: dvd.Palette{"808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080"}}, dvd.Title{TitleNumber: 6, Angles: 1, FPS: 25, Width: 720, Height: 576, Format: "PAL", AutomaticLetterbox: false, Length: 72680000000, AudioTracks: []dvd.Audio{dvd.Audio{Language: dvd.Language{Code: "de", Name: "Deutsch"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}}, SubtitleTracks: []dvd.Subtitle{dvd.Subtitle{Language: dvd.Language{Code: "bg", Name: "Bulgarian"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "hr", Name: "Hrvatski"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "cs", Name: "Czech"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "da", Name: "Dansk"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "en", Name: "English"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "fi", Name: "Suomi"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "no", Name: "Norsk"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "pl", Name: "Polish"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "pt", Name: "Portugues"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "sl", Name: "Slovenian"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "sv", Name: "Svenska"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "cs", Name: "Czech"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "pl", Name: "Polish"}, Content: "Undefined"}}, Chapters: []dvd.Chapter{dvd.Chapter{Length: 72200000000, StartCell: 1}, dvd.Chapter{Length: 480000000, StartCell: 2}}, Cells: []dvd.Cell{dvd.Cell{Length: 72200000000}, dvd.Cell{Length: 480000000}}, Palette: dvd.Palette{"808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080"}}, dvd.Title{TitleNumber: 7, Angles: 1, FPS: 25, Width: 720, Height: 576, Format: "PAL", AutomaticLetterbox: false, Length: 65760000000, AudioTracks: []dvd.Audio{dvd.Audio{Language: dvd.Language{Code: "es", Name: "Espanol"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}}, SubtitleTracks: []dvd.Subtitle{dvd.Subtitle{Language: dvd.Language{Code: "bg", Name: "Bulgarian"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "hr", Name: "Hrvatski"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "cs", Name: "Czech"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "da", Name: "Dansk"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "en", Name: "English"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "fi", Name: "Suomi"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "no", Name: "Norsk"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "pl", Name: "Polish"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "pt", Name: "Portugues"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "sl", Name: "Slovenian"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "sv", Name: "Svenska"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "cs", Name: "Czech"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "pl", Name: "Polish"}, Content: "Undefined"}}, Chapters: []dvd.Chapter{dvd.Chapter{Length: 65280000000, StartCell: 1}, dvd.Chapter{Length: 480000000, StartCell: 2}}, Cells: []dvd.Cell{dvd.Cell{Length: 65280000000}, dvd.Cell{Length: 480000000}}, Palette: dvd.Palette{"808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080"}}, dvd.Title{TitleNumber: 8, Angles: 1, FPS: 25, Width: 720, Height: 576, Format: "PAL", AutomaticLetterbox: false, Length: 54879999999, AudioTracks: []dvd.Audio{dvd.Audio{Language: dvd.Language{Code: "it", Name: "Italiano"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}}, SubtitleTracks: []dvd.Subtitle{dvd.Subtitle{Language: dvd.Language{Code: "bg", Name: "Bulgarian"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "hr", Name: "Hrvatski"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "cs", Name: "Czech"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "da", Name: "Dansk"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "en", Name: "English"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "fi", Name: "Suomi"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "no", Name: "Norsk"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "pl", Name: "Polish"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "pt", Name: "Portugues"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "sl", Name: "Slovenian"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "sv", Name: "Svenska"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "cs", Name: "Czech"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "pl", Name: "Polish"}, Content: "Undefined"}}, Chapters: []dvd.Chapter{dvd.Chapter{Length: 54399999999, StartCell: 1}, dvd.Chapter{Length: 480000000, StartCell: 2}}, Cells: []dvd.Cell{dvd.Cell{Length: 54399999999}, dvd.Cell{Length: 480000000}}, Palette: dvd.Palette{"808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080"}}, dvd.Title{TitleNumber: 9, Angles: 1, FPS: 25, Width: 720, Height: 576, Format: "PAL", AutomaticLetterbox: false, Length: 480000000, AudioTracks: []dvd.Audio(nil), SubtitleTracks: []dvd.Subtitle(nil), Chapters: []dvd.Chapter{dvd.Chapter{Length: 480000000, StartCell: 1}}, Cells: []dvd.Cell{dvd.Cell{Length: 480000000}}, Palette: dvd.Palette{"808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080"}}, dvd.Title{TitleNumber: 10, Angles: 1, FPS: 25, Width: 720, Height: 576, Format: "PAL", AutomaticLetterbox: false, Length: 99760000000, AudioTracks: []dvd.Audio{dvd.Audio{Language: dvd.Language{Code: "cs", Name: "Czech"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}, dvd.Audio{Language: dvd.Language{Code: "en", Name: "English"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}, dvd.Audio{Language: dvd.Language{Code: "pl", Name: "Polish"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}}, SubtitleTracks: []dvd.Subtitle{dvd.Subtitle{Language: dvd.Language{Code: "bg", Name: "Bulgarian"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "hr", Name: "Hrvatski"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "cs", Name: "Czech"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "da", Name: "Dansk"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "en", Name: "English"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "fi", Name: "Suomi"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "no", Name: "Norsk"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "pl", Name: "Polish"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "pt", Name: "Portugues"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "sl", Name: "Slovenian"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "sv", Name: "Svenska"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "cs", Name: "Czech"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "pl", Name: "Polish"}, Content: "Undefined"}}, Chapters: []dvd.Chapter{dvd.Chapter{Length: 99760000000, StartCell: 1}}, Cells: []dvd.Cell{dvd.Cell{Length: 99760000000}}, Palette: dvd.Palette{"808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080"}}, dvd.Title{TitleNumber: 11, Angles: 1, FPS: 25, Width: 720, Height: 576, Format: "PAL", AutomaticLetterbox: false, Length: 79079999999, AudioTracks: []dvd.Audio{dvd.Audio{Language: dvd.Language{Code: "cs", Name: "Czech"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}, dvd.Audio{Language: dvd.Language{Code: "en", Name: "English"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}, dvd.Audio{Language: dvd.Language{Code: "pl", Name: "Polish"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}}, SubtitleTracks: []dvd.Subtitle{dvd.Subtitle{Language: dvd.Language{Code: "bg", Name: "Bulgarian"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "hr", Name: "Hrvatski"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "cs", Name: "Czech"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "da", Name: "Dansk"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "en", Name: "English"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "fi", Name: "Suomi"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "no", Name: "Norsk"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "pl", Name: "Polish"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "pt", Name: "Portugues"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "sl", Name: "Slovenian"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "sv", Name: "Svenska"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "cs", Name: "Czech"}, Content: "Undefined"}, dvd.Subtitle{Language: dvd.Language{Code: "pl", Name: "Polish"}, Content: "Undefined"}}, Chapters: []dvd.Chapter{dvd.Chapter{Length: 79079999999, StartCell: 1}}, Cells: []dvd.Cell{dvd.Cell{Length: 79079999999}}, Palette: dvd.Palette{"808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080"}}}}, dvd.TitleSet{Titles: []dvd.Title{dvd.Title{TitleNumber: 12, Angles: 1, FPS: 25, Width: 720, Height: 576, Format: "PAL", AutomaticLetterbox: true, Length: 27319999999, AudioTracks: []dvd.Audio{dvd.Audio{Language: dvd.Language{Code: "cs", Name: "Czech"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 6}}, SubtitleTracks: []dvd.Subtitle(nil), Chapters: []dvd.Chapter{dvd.Chapter{Length: 26839999999, StartCell: 1}, dvd.Chapter{Length: 480000000, StartCell: 2}}, Cells: []dvd.Cell{dvd.Cell{Length: 26839999999}, dvd.Cell{Length: 480000000}}, Palette: dvd.Palette{"808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080"}}}}, dvd.TitleSet{Titles: []dvd.Title{dvd.Title{TitleNumber: 13, Angles: 1, FPS: 25, Width: 720, Height: 576, Format: "PAL", AutomaticLetterbox: true, Length: 48720000000, AudioTracks: []dvd.Audio{dvd.Audio{Language: dvd.Language{Code: "cs", Name: "Czech"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}}, SubtitleTracks: []dvd.Subtitle(nil), Chapters: []dvd.Chapter{dvd.Chapter{Length: 48240000000, StartCell: 1}, dvd.Chapter{Length: 480000000, StartCell: 2}}, Cells: []dvd.Cell{dvd.Cell{Length: 48240000000}, dvd.Cell{Length: 480000000}}, Palette: dvd.Palette{"808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080"}}, dvd.Title{TitleNumber: 14, Angles: 1, FPS: 25, Width: 720, Height: 576, Format: "PAL", AutomaticLetterbox: true, Length: 49839999999, AudioTracks: []dvd.Audio{dvd.Audio{Language: dvd.Language{Code: "cs", Name: "Czech"}, Content: "Undefined", Format: "ac3", Frequency: 48000, DynamicRangeControl: true, Channels: 2}}, SubtitleTracks: []dvd.Subtitle(nil), Chapters: []dvd.Chapter{dvd.Chapter{Length: 49359999999, StartCell: 1}, dvd.Chapter{Length: 480000000, StartCell: 2}}, Cells: []dvd.Cell{dvd.Cell{Length: 49359999999}, dvd.Cell{Length: 480000000}}, Palette: dvd.Palette{"808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080", "808080"}}}}}}

	// Exercise SUT
	actual, err := dvdInfoServiceImpl.ReadDVDInfoForDirectory("some dir")

	// Verify results
	if err != nil {
		t.Errorf("Expected nil error, but got %v", err)
	}
	if !reflect.DeepEqual(actual, expected) {
		t.Errorf("Response did not match expected\nExpected: %#v\nActual: %#v", expected, actual)
	}
}

type mockDockerService struct {
	stdOut string
	stdErr string
	err    error
}

func (mds *mockDockerService) RunDockerContainerForOutput(image string, mounts []exec.DockerVolumeMount, args []string) (string, string, error) {
	return mds.stdOut, mds.stdErr, mds.err
}
